<aura:component controller="Loop.LayoutButtonController">
    
    <aura:attribute name="sessionId" type="String" default=""/>
    <aura:attribute name="apiUrl" type="String" default=""/>
    
    <!--Internal attributes-->
    <aura:attribute name="customizeApplication" type="Boolean" default="true" required="true"/>
    <aura:attribute name="searchText" type="String"/>
    <aura:attribute name="isLoading" type="boolean" default="true" access="private"/>
    <aura:attribute name="isAuthorized" type="boolean" default="true" access="private"/>
    <aura:attribute name="connectedAppsEnabled" type="boolean" default="false" access="private"/>
    <aura:attribute name="oAuthUrl" type="string" default="" access="private"/>
    
    <!--Handled events-->
    <aura:handler name="init" value="{!this}" action="{!c.onInit}"/>
    <aura:handler event="Loop:oAuthSuccessful" action="{!c.handleOAuthSuccessful}"/>
    <aura:handler name="filterObjects" event="Loop:filterObjects" action="{!c.filterObjects}"/>
    
    <!--Registered events-->
    <aura:registerEvent name="showError" type="Loop:showError"/>
    
    <!--Methods-->
    <aura:method name="save" action="{!c.save}" access="Public"/>
    
    <div class="slds">
        <aura:if isTrue="{!v.customizeApplication}">
            <aura:if isTrue="{!v.isLoading}">
                <div class="slds-grid slds-grid--align-center">
                    <div class="slds-spinner-container">
                        <img src="/resource/Loop__SalesforceLightning/assets/images/spinners/slds_spinner_brand.gif" alt="Loading..." style="height:64px;"/>
                    </div>
                </div>
                <aura:set attribute="else">
                    <aura:if isTrue="{!!v.isAuthorized &amp;&amp; v.connectedAppsEnabled}">
                        <h3 class="slds-text-heading--small slds-m-bottom--medium">You must authorize the app to add a button on standard and custom objects in Classic Experience.</h3>
                        <div class="slds-grid slds-grid--align-center">
                            <button class="slds-button slds-button--brand" onclick="{!c.startOAuth}">Authorize Drawloop Document Generation</button>
                        </div>
                        <aura:set attribute="else">
                            <h3 class="slds-text-heading--small slds-m-bottom--medium">Check the box next to each Classic Experience layout that you would like to add a button on standard and custom objects. For each layout that is enabled, a button will automatically be added.</h3>
                            <Loop:LayoutButtonSearch />
                            <Loop:LayoutButtonTable aura:id="layoutButtonTable" sessionId="{!v.sessionId}" searchText="{!v.searchText}" apiUrl="{!v.apiUrl}"/>
                        </aura:set>
                    </aura:if>
                </aura:set>
            </aura:if>
            <aura:set attribute="else">
                <Loop:Toast toastClass="slds-notify slds-notify--toast slds-theme--warning" toastMessage="You must have the Customize Application permission to add buttons to page layouts." toastStyle="margin:0;"/>
            </aura:set>
        </aura:if>
    </div>
</aura:component>
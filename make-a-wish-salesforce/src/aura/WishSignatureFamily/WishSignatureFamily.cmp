<aura:component controller="WishSignatureController" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId" access="global">
    
    <!-- attributes -->
    <aura:attribute name="recordId" type="Id"/>
    <aura:attribute name="objectName" type="String" default="Wish_Required_Signature__c"/>
    <aura:attribute name="fieldsetName" type="String" default="FamilySignatureTracker"/>
    <aura:attribute name="typeOfSignature" type="String" default="Family"/>
    <aura:attribute name="showModal" type="Boolean" default="false" />
    <aura:attribute name="selectedLookUpRecord" type="String" />
    <aura:attribute name="wrapperList" type="object"/>
    <aura:attribute name="adultList" type="List"/>
    <aura:attribute name="adultChildMap" type="List"/>
    <aura:attribute name="options" type="List" default="[]"/>
    
    <!-- handlers -->
    <aura:handler name="init" value="{! this }" action="{! c.init }"/>

    <!-- Body -->    
    <lightning:card title="">
        <div class="c-container">
            <lightning:layout>
                <lightning:layoutItem flexibility="auto" size="10" padding="around-small">
                    <div class="slds-text-heading_medium">Wish Required Signatures - {!v.typeOfSignature} </div>
                </lightning:layoutItem>
                 <lightning:layoutItem flexibility="auto" size="1" padding="around-small">
                    <div class="custom-box">
                        <lightning:buttonIcon class="slds-float_right" iconName="utility:refresh" variant="border-filled" onclick="{! c.handleRefresh }" alternativeText="Refresh" />
                    </div>
                </lightning:layoutItem>
                <lightning:layoutItem flexibility="auto" size="1" padding="around-small">
                    <div class="custom-box">
                        <lightning:button label="New" title="New Wish Signatures" onclick="{! c.handleClick }" />
                    </div>
                </lightning:layoutItem>
            </lightning:layout>
        </div>
        <lightning:layout multipleRows="true">
            <lightning:layoutItem size="12" flexibility="auto" padding="around-small">
                    <div class="custom-box">
                        <c:LightningDataTable aura:id="familyDatatable" objectName="{!v.objectName}" fieldsetName="{!v.fieldsetName}" typeOfSignature="{!v.typeOfSignature}" caseId="{!v.recordId}"/> 
                    </div>
            </lightning:layoutItem>
        </lightning:layout>
    </lightning:card>
    
    <!-- Add Required Signature Modal Begin -->
    <aura:if isTrue="{!v.showModal}">
        <c:sldsModal aura:id="addFormModal" closeModal="true"  closeAction="{!c.handleCancel}">
            <aura:set attribute="header">
                Add Wish Required Signatures
            </aura:set>
            <aura:set attribute="content">
                <lightning:combobox name="FindForms" label="Find Forms" placeholder="Select a Form" options="{! v.options }" onchange="{! c.handleChange }"/>
               <!-- <c:customLookup aura:id="FindForms" objectAPIName="Wish_Signature_Forms__c"
                                disabledAttr="false"
                                IconName="doctype:gform"
                                additionalParams=""
                                componentMessage="conditiondescription"
                                placeholderText="Find Wish Forms"
                                selectedRecord="{!v.selectedLookUpRecord}"
                                labelClass="slds-form-element__label slds-m-bottom_x-small"
                                label="Find Forms "
                                selectedRecordId="{!v.recordId}"
                                formType="Non-Medical"/> -->
                <span class="slds-form-element__label slds-p-top_large">
                    Choose Signer : </span>
                <lightning:accordion allowMultipleSectionsOpen="true">
                    <aura:iteration items="{!v.wrapperList}" var="adult">
                        <lightning:accordionSection name="{!adult.con.Id}" label="{!adult.con.FirstName + ' ' + adult.con.LastName}">
                            <aura:set attribute="body">
                                <div class="c-container">
                                    <dl class="slds-dl_horizontal">
                                        <dt class="slds-dl_horizontal__label">
                                            <p class="slds-truncate">Wish Affiliation Type :</p>
                                        </dt>
                                        <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                             {!adult.wishAff.Wish_Affiliation_Type__c}
                                        </dd>
                                        <dt class="slds-dl_horizontal__label">
                                            <p class="slds-truncate">Relationship Type :</p>
                                        </dt>
                                        <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                {!adult.wishAff.Relationship_Type__c}
                                        </dd>
                                         <dt class="slds-dl_horizontal__label">
                                            <p class="slds-truncate">Related To :</p>
                                        </dt>
                                        <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                                {!adult.wishAff.Relationship__r.npe4__Contact__r.FirstName + ' ' + adult.wishAff.Relationship__r.npe4__Contact__r.LastName} 
                                        </dd>
                                         <dt class="slds-dl_horizontal__label">
                                             <p class="slds-truncate">Parent/Legal Guardian :</p>
                                        </dt>
                                        <dd class="slds-dl_horizontal__detail slds-tile__meta">
                                             <lightning:input type="checkbox" disabled="true" checked="{!adult.wishAff.Parent_Legal_Guardian__c}"/>
                                        </dd>
                                    </dl>
                                    <lightning:layout multipleRows="true">
                                        <lightning:layoutItem padding="around-small">
                                            <div class="custom-box slds-float_left">
                                                <b>On Behalf Of</b>
                                                 <lightning:input type="checkbox" label="Self" name="{!join(',',adult.con.Id,adult.wishAff.Id)}" checked="{!adult.isSelected}" onchange="{!c.handleAdultCheck}"/>
                                                <aura:iteration items="{!adult.lstMinors}" var="minor">
                                                    <lightning:input type="checkbox" label="{!minor.con.FirstName + ' ' + minor.con.LastName}" name="{!join(',', minor.con.Id, adult.con.Id, minor.wishAff.Id)}" checked="{!minor.isSelected}" onchange="{!c.handleMinorCheck}" />
                                                </aura:iteration>
                                            </div>
                                        </lightning:layoutItem>
                                    </lightning:layout>
                                </div>
                            </aura:set>
                        </lightning:accordionSection>
                    </aura:iteration>
                </lightning:accordion>
            </aura:set>
            <aura:set attribute="footer">
                <lightning:button label="Add" variant="brand" title="Save action" onclick="{! c.handleSave }" />
                <lightning:button label="Cancel" title="Cancle action" onclick="{! c.handleCancel }" />
            </aura:set>
        </c:sldsModal>
    </aura:if>
    
</aura:component>
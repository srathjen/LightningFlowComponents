<aura:component controller="Loop.SampleDdpController">
    <!--Required attributes-->
    <aura:attribute name="sessionId" type="string" required="true"/>
    
    <!--Optional attributes-->
    <aura:attribute name="loopUrl" type="string" default=""/>
    
    <!--Internal attributes-->
    <aura:attribute name="isLoading" type="boolean" default="true" access="private"/>
    <aura:attribute name="isAuthorized" type="boolean" default="false" access="private"/>
    <aura:attribute name="connectedAppsEnabled" type="boolean" default="false" access="private"/>
    <aura:attribute name="oAuthUrl" type="string" default="" access="private"/>
    <aura:attribute name="searchText" type="string" access="private"/>
    <aura:attribute name="businessUser" type="string" access="private"/>
    
    <!--Methods-->
    <aura:method name="save" action="{!c.save}"/>
    
    <!--Registered events-->
    <aura:registerEvent name="showError" type="Loop:showError"/>
    
    <!--Handled events-->
    <aura:handler name="init" value="{!this}" action="{!c.onInit}"/>
    <aura:handler event="Loop:oAuthSuccessful" action="{!c.handleOAuthSuccessful}"/>
    <aura:handler name="filterDdps" event="Loop:filterDdps" action="{!c.filterDdps}"/>
    
    <div class="slds">
        <aura:if isTrue="{!v.isLoading}">
            <div class="slds-grid slds-grid--align-center">
                <div class="slds-spinner-container">
                    <img src="/resource/Loop__SalesforceLightning/assets/images/spinners/slds_spinner_brand.gif" alt="Loading..." style="height:64px;"/>
                </div>
            </div>
            <aura:set attribute="else">
                <aura:if isTrue="{!!v.isAuthorized &amp;&amp; v.connectedAppsEnabled}">
                    <h3 class="slds-text-heading--small slds-m-bottom--medium">You must authorize the app to migrate sample DDPs.</h3>
                    <div class="slds-grid slds-grid--align-center">
                        <button class="slds-button slds-button--brand" onclick="{!c.startOAuth}">Authorize Drawloop Document Generation</button>
                    </div>
                    <aura:set attribute="else">
                        <h3 class="slds-text-heading--small slds-m-bottom--medium">Sample DDPs provide everything needed to help you design templates for your business use cases. Select one or more templates below and then be sure to add the corresponding button for each page layout. For example, if you choose a sample DDP that uses Account as the main object, you will need to add a button to an Account page layout.</h3>
                        <Loop:SampleDdpSearch sessionId="{!v.sessionId}" loopUrl="{!v.loopUrl}"/>
                        <Loop:SampleDdpTable sessionId="{!v.sessionId}" aura:id="sampleDdpTable" searchText="{!v.searchText}" businessUser="{!v.businessUser}" loopUrl="{!v.loopUrl}"/>
                    </aura:set>
                </aura:if>
            </aura:set>
        </aura:if>
    </div>
</aura:component>